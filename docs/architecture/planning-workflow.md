# 계획 워크플로우 (Planning Workflow)

> 코드 작성 전 아키텍처와 설계를 먼저 확정하는 워크플로우

---

## 핵심 철학

```
"계획에 80%의 시간을 투자하고, 실행에 20%"
- Peter Steinberger
```

AI 시대에 개발자의 핵심 역량:
- 코드 작성 능력 ❌
- 무엇을, 왜, 어떻게 결정하는 능력 ✅

---

## 워크플로우 전체 흐름

```
┌─────────────────────────────────────────────────────────────┐
│  TRIGGER: 계획 관련 대화 감지                                │
│  ("어떻게 할까", "설계", "구현 방법", "만들자" 등)            │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  STEP 1: 맥락 파악                                          │
│  ─────────────────────────────────────────────────────────  │
│  "뭘 하려는 건지" 이해                                       │
│                                                             │
│  → 시나리오 분류:                                            │
│    □ 새 기능    □ 버그 수정    □ 리팩토링                    │
│    □ 성능 최적화    □ 마이그레이션    □ 기타                 │
│                                                             │
│  → 동적 체크리스트 생성 (이 맥락에서 결정해야 할 것들)        │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  STEP 2: 탐색 (필요시)                                      │
│  ─────────────────────────────────────────────────────────  │
│  시나리오에 따라 적절한 에이전트 호출:                        │
│                                                             │
│  새 기능/리팩토링  → Explore (구조 파악)                     │
│  버그 수정        → Debugger (원인 추적)                     │
│  리팩토링/마이그  → Architect (의존성/영향)                  │
│  성능 최적화      → Profiler (병목 분석)                     │
│                                                             │
│  탐색 결과를 바탕으로 체크리스트 업데이트                     │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  STEP 3: 구체화 대화 (핵심)                                  │
│  ─────────────────────────────────────────────────────────  │
│  AskUserQuestion 적극 활용 - "뇌 빨아먹기"                   │
│                                                             │
│  체크리스트 항목별로:                                        │
│  - 애매한 것 → 선택지 제공                                   │
│  - 결정 필요한 것 → 트레이드오프 설명                        │
│  - 빠뜨린 것 → 발견해서 추가                                 │
│                                                             │
│  ↺ 반복: 질문 → 답변 → 체크리스트 채움                       │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  STEP 4: 완료 판단                                          │
│  ─────────────────────────────────────────────────────────  │
│  체크리스트 대부분 채워짐                                    │
│                                                             │
│  → AskUserQuestion:                                         │
│    "핵심 결정들이 정리된 것 같아. 어떻게 할까?"              │
│    □ 구현 시작                                              │
│    □ 더 얘기하자                                            │
│    □ [특정 항목] 더 파고들기                                 │
│                                                             │
│  "더 얘기하자" → STEP 3로                                   │
│  "구현 시작"  → STEP 5로                                    │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  STEP 5: 계획 확정 & 저장                                   │
│  ─────────────────────────────────────────────────────────  │
│  계획 요약 생성:                                             │
│  - 결정된 사항들                                             │
│  - 구현 방향                                                │
│  - 주의할 점                                                │
│                                                             │
│  → .claude/plans/{date}-{slug}.md 저장                      │
│  → 구현 단계로 전환                                          │
└─────────────────────────────────────────────────────────────┘
```

---

## 구성요소

### Rule (행동 규칙)

| 규칙 | 설명 |
|------|------|
| 자동 진입 | 계획 관련 키워드 감지 시 Plan 모드 진입 |
| 질문 폭격 | AskUserQuestion 적극 활용, 모호함 → 구체화 |
| 동적 체크리스트 | 맥락에 따라 결정해야 할 항목 자동 생성 |
| 완료 제안 | 체크리스트 충족 시 사용자에게 확인 |

### Agents (에이전트)

| 에이전트 | 역할 | 사용 시나리오 |
|---------|------|-------------|
| **Explore** | 코드베이스 탐색, 구조 파악 | 모든 시나리오 |
| **Debugger** | 버그 원인 추적, 로그 분석 | 버그 수정 |
| **Architect** | 의존성 분석, 영향 범위 파악 | 리팩토링, 마이그레이션 |
| **Profiler** | 성능 측정, 병목 분석 | 성능 최적화 |

### Skill (유틸리티)

| 스킬 | 역할 |
|------|------|
| 계획 저장 | `.claude/plans/`에 계획 문서 저장 |
| 계획 불러오기 | 저장된 계획 참조 |

---

## 시나리오별 플로우

### 새 기능 추가

```
요구사항 파악 → 기존 구조 탐색 → 설계 결정 → 계획 확정
     ↓              ↓              ↓
  (질문폭격)    (Explore)      (질문폭격)
```

### 버그 수정

```
증상 파악 → 원인 탐색 → 복잡도 판단 → (계획 or 바로 수정)
    ↓           ↓            ↓
 (질문)    (Explore/      (자동 판단)
           Debugger)
```

### 리팩토링

```
현재 상태 분석 → 목표 상태 정의 → 영향 범위 파악 → 단계별 계획
      ↓               ↓               ↓
  (Explore)       (질문폭격)      (Architect)
```

### 성능 최적화

```
병목 측정 → 원인 분석 → 개선안 도출 → 계획
    ↓           ↓           ↓
 (Profiler)  (Explore)   (질문폭격)
```

### 마이그레이션

```
현재 상태 완전 파악 → 목표 정의 → 리스크 분석 → 상세 계획 → 롤백 계획
        ↓               ↓            ↓             ↓
    (Explore        (질문폭격)   (Architect)    (질문폭격)
     깊게)
```

---

## 동적 체크리스트 예시

### 새 기능: "인증 시스템"

```markdown
결정해야 할 것들:
- [ ] 인증 방식 (JWT / Session / OAuth)
- [ ] 사용자 저장소 (DB 스키마)
- [ ] 세션 만료 정책
- [ ] 보안 요구사항
- [ ] API 엔드포인트 구조
```

### 버그 수정: "로그인 간헐적 실패"

```markdown
파악해야 할 것들:
- [ ] 재현 조건
- [ ] 에러 로그/메시지
- [ ] 언제부터 발생?
- [ ] 영향 범위
```

### 리팩토링: "모듈 분리"

```markdown
결정해야 할 것들:
- [ ] 목표 구조
- [ ] 단계적 vs 한번에
- [ ] 테스트 커버리지 확인
- [ ] 영향받는 의존성
```

---

## "뇌 빨아먹기" 원칙

Plan 모드의 핵심 = **모호함 → 구체화** 대화

```
모호: "사용자 인증 추가해야해"
     ↓ (질문 폭격)
구체: "JWT 기반, /api/auth/login 엔드포인트,
      세션 만료 24시간, 리프레시 토큰 있음"
```

### AskUserQuestion 활용

```
애매한 것 발견 → 바로 질문

예: "사용자 관리 기능 만들자"
    ↓
- "사용자"가 누구? 관리자? 일반 유저?
- "관리"가 뭐? CRUD? 권한? 프로필?
- 규모는? 100명? 100만명?
```

---

## 에이전트 필요성 판단

| 조건 | 에이전트 필요? |
|------|--------------|
| 병렬 작업 | ✅ 여러 파일 동시 분석 |
| 독립적 서브태스크 | ✅ 코드 탐색, 분석 |
| 1:1 대화 | ❌ 메인 Claude가 직접 |

**계획 단계**: 대화는 메인 Claude, 탐색은 에이전트 위임

---

## 미래 개선: 피드백 루프

```
┌─────────────────────────────────────────┐
│           Agent 호출 로깅               │
├─────────────────────────────────────────┤
│ - 누가 호출됨                           │
│ - 언제, 어떤 맥락에서                   │
│ - 결과가 유용했는지                     │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│           패턴 분석 → 시스템 개선        │
└─────────────────────────────────────────┘
```

---

## 관련 문서

- [phase1-001-architecture-first-planning.md](../backlogs/doing/phase1-001-architecture-first-planning.md) - 백로그 태스크
- CLAUDE.md - 프로젝트 원칙

---

**Last Updated**: 2026-01-31
