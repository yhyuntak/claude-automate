---
name: planning
description: Brain 기반 구현 계획 수립. "planning", "계획", "어떻게 구현", "설계" 키워드로 자동 활성화
argument-hint: "[feature description]"
---

# /planning

> Brain의 패턴과 예시를 참고하여 구현 계획 수립

$ARGUMENTS

---

## ⚠️ 실행 순서 (반드시 준수)

```
Phase 0 → Phase 0.5 → Phase 1 → Phase 2 → Phase 3 → Phase 3.5 → Phase 4 → Phase 5
```

**절대 건너뛰지 마세요. Phase 0부터 시작하세요.**

---

## 필수/조건부 단계 구분

### 🔴 필수 단계 (스킵 불가)

| Phase | 이름 | 설명 |
|-------|------|------|
| 0 | 요구사항 충분도 판단 | Context/Why, What, Success Criteria 확인 |
| 0.5 | devil 😈 현실성 검증 | 기술적 실현 가능성, 리스크 검증 |
| 1 | 계획 유형 분류 | 코드베이스 탐색 필요 여부 결정 |
| 4 | Plan Mode 진입 | EnterPlanMode 호출 |
| 5 | devil 😈 최종 검증 | 계획의 논리적 정합성 검증 |

### 🟡 조건부 단계 (유형에 따라)

| Phase | 이름 | 실행 조건 |
|-------|------|----------|
| 2 | 코드베이스 탐색 | 유형 A(기존 코드 수정), B(신규 구현) |
| 3 | Brain 참조 | `.claude/brain.md` 존재 시 |
| 3.5 | ASCII 시각화 | 복잡한 구조 설명 필요 시 |

---

## 목적

**brainstorm vs planning 구분:**

| 단계 | 목적 | Brain 필요 |
|------|------|-----------|
| brainstorm | **뭘** 만들지 구체화 | ❌ |
| planning | **어떻게** 만들지 계획 | ✅ |

---

## 플로우 개요

```
[사용자 요청]
      │
      ▼
┌─────────────────────────────────────┐
│ 🔴 Phase 0: 요구사항 충분도 판단    │
│    - Context/Why                    │
│    - What                           │
│    - Success Criteria/Scope         │
└─────────────────────────────────────┘
      │
      ├─ 부족 → brainstorm 호출 제안 (angel 😇)
      │              │
      ▼              │
     충분 ←──────────┘
      │
      ▼
┌─────────────────────────────────────┐
│ 🔴 Phase 0.5: devil 😈 현실성 검증  │
└─────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│ 🔴 Phase 1: 계획 유형 분류          │
│    A) 기존 코드 수정                │
│    B) 신규 구현                     │
│    C) 개념/문서/설계                │
└─────────────────────────────────────┘
      │
      ├─ A, B → Phase 2 실행
      └─ C → Phase 2 스킵
      │
      ▼
┌─────────────────────────────────────┐
│ 🟡 Phase 2: 코드베이스 탐색 (조건부)│
└─────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│ 🟡 Phase 3: Brain 참조 (있으면)     │
└─────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│ 🟡 Phase 3.5: ASCII 시각화 (필요시) │
└─────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│ 🔴 Phase 4: Plan Mode 진입          │
└─────────────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│ 🔴 Phase 5: devil 😈 계획 최종 검증 │
└─────────────────────────────────────┘
```

---

## 실행 프로토콜

### 🔴 Phase 0: 요구사항 충분도 판단

계획 수립 전, 요구사항이 충분한지 확인:

**통과 기준**: 최소 3개 명확해야 함

- [ ] **Context 또는 Why** - 왜 이 기능이 필요한가?
- [ ] **What (핵심 기능)** - 무엇을 구현하는가?
- [ ] **Success Criteria 또는 Scope** - 어떻게 검증하는가? 어디까지 포함하는가?

**판단 방법**:
1. 사용자 요청에서 위 3가지 체크리스트 평가
2. 2개 이하만 명확하면 **요구사항 부족**으로 판단

**요구사항 부족 시**:
```
"요구사항이 충분하지 않습니다. 더 구체화하기 위해 brainstorm 스킬을 사용하시겠습니까?"

brainstorm 스킬에서 angel 😇이 생각을 확장해드립니다.
```

AskUserQuestion으로 brainstorm 호출 제안.

**요구사항 충분 시**: Phase 0.5로 이동

---

### 🔴 Phase 0.5: devil 현실성 검증

요구사항 확정 직후, devil 에이전트 호출:

**에이전트 호출**:
```
---
## 🔄 에이전트 호출: devil 😈
> 현실성 검증 중...
---
```

```
Task(
  subagent_type="claude-automate:devil",
  prompt="""
## 검증 대상
{요구사항 요약}

## 검증 항목
- 기술적 실현 가능성
- 리소스 (시간, 인력) 현실성
- 의존성 복잡도
- 잠재적 리스크

## 출력 형식
### 경고 사항
- {우려 1}
- {우려 2}

### 제안
- {대안 또는 완화책}
"""
)
```

```
---
## ✅ 에이전트 완료: devil 😈
---
```

검증 후 Phase 1로 이동.

---

### 🔴 Phase 1: 계획 유형 분류

사용자 요청을 분석하여 계획 유형 결정:

| 유형 | 특징 | 코드베이스 탐색 | 예시 |
|------|------|----------------|------|
| A) 기존 코드 수정 | 버그 수정, 기능 변경, 리팩토링 | 🔴 필수 | "이 버그 수정해줘", "기능 변경해줘" |
| B) 신규 구현 | 새 기능, 새 모듈, 새 파일 | 🟡 권장 | "새로운 기능 추가해줘" |
| C) 개념/문서/설계 | 아키텍처 논의, 문서 작성, 설계 검토 | ⚪ 스킵 | "설계 검토해줘", "개념 설명해줘" |

**판단 방법**:
- 기존 코드 언급, 수정/변경/리팩토링 키워드 → **A**
- "새로운", "추가", "생성" 키워드 → **B**
- "설계", "개념", "문서", "아키텍처", "검토" 키워드 → **C**
- 불확실 시 → AskUserQuestion으로 확인

**출력 형식**:
```markdown
## Phase 1 결과: 계획 유형 분류

**분류**: {A/B/C} - {유형명}
**근거**: {왜 이 유형으로 분류했는지}
**코드베이스 탐색**: {필수/권장/스킵}
```

유형에 따라 Phase 2 실행 여부 결정 후 진행.

---

### 🟡 Phase 2: 코드베이스 탐색 (조건부)

**실행 조건**: 유형 A 또는 B인 경우

무엇을 수정/생성할지 파악:

```
- 기존 관련 코드 위치 확인
- 의존성 파악
- 영향 범위 추정
```

**유형 C인 경우**:
```markdown
## Phase 2 스킵

**이유**: 개념/문서/설계 유형으로 코드베이스 탐색 불필요
```

Phase 3으로 이동.

---

### 🟡 Phase 3: Brain 참조 (조건부)

**실행 조건**: `.claude/brain.md` 존재 시

1. `.claude/brain.md` 존재 여부 확인

2. **Brain이 있으면:**
   - 패턴 인덱스 읽기
   - 구현 틀에 맞는 패턴 링크 식별
   - 해당 상세 파일 읽기 (`.claude/brain/patterns/*.md`)
   - 예시 기반 설계

3. **Brain이 없으면:**
   - ⚠️ 경고 표시: "이 프로젝트에 brain.md가 없습니다. 코드베이스 탐색 결과만으로 계획을 수립합니다."
   - 코드베이스 탐색 결과만으로 계획 수립
   - 계획 출력에 "참고한 패턴: 없음 (brain 미설정)" 표시

```bash
# Brain 존재 확인
ls .claude/brain.md

# Brain이 있으면 인덱스 확인
cat .claude/brain.md

# 필요한 패턴 상세 읽기
cat .claude/brain/patterns/{relevant-pattern}.md
```

---

### 🟡 Phase 3.5: ASCII 시각화 제안 (조건부)

**실행 조건**: 복잡한 구조 설명 필요 시

계획 수립 전, 시각화가 필요한지 판단:

**시각화 제안 조건** (하나라도 해당 시):
- UI 레이아웃을 설명해야 할 때
- 데이터 플로우를 설명해야 할 때
- 아키텍처 구조를 설명해야 할 때
- 글로 설명하면 장황해질 때

**제안 방법**:
```
"이 계획은 시각화하면 이해가 쉬울 것 같습니다. ASCII 다이어그램을 포함하시겠습니까?"

예시:
- 플로우차트 (실행 흐름)
- 컴포넌트 다이어그램 (구조)
- 시퀀스 다이어그램 (상호작용)
```

AskUserQuestion으로 시각화 포함 여부 확인.

---

### 🔴 Phase 4: Plan Mode 진입

패턴 예시를 참고하여 계획 수립:

```
EnterPlanMode 호출
```

Plan Mode 내에서 계획 문서 작성:

```markdown
# 구현 계획: {Feature Name}

## 참고한 패턴
- {pattern 1}: {왜 필요한지}
- {pattern 2}: {왜 필요한지}

## 수정/생성할 파일
| 파일 | 변경 내용 | 참고 패턴 |
|------|----------|----------|
| {path} | {변경 내용} | {pattern} |

## 구현 순서
1. {step 1}
2. {step 2}
3. {step 3}

## 패턴 적용 예시
{brain에서 가져온 예시 기반 설계}

## 검증 방법
- [ ] {검증 항목 1}
- [ ] {검증 항목 2}
```

---

### 🔴 Phase 5: devil 계획 최종 검증

계획 완성 후, devil 에이전트 호출:

**에이전트 호출**:
```
---
## 🔄 에이전트 호출: devil 😈
> 계획 최종 검증 중...
---
```

```
Task(
  subagent_type="claude-automate:devil",
  prompt="""
## 검증 대상
{작성된 계획 요약}

## 검증 항목
- 구현 순서의 논리적 정합성
- 놓친 edge case
- 테스트 가능성
- 롤백 가능성

## 출력 형식
### 잠재적 문제
- {문제 1}
- {문제 2}

### 개선 제안
- {제안 1}
- {제안 2}
"""
)
```

```
---
## ✅ 에이전트 완료: devil 😈
---
```

검증 후 계획 확정. ExitPlanMode 호출.

---

## 주의사항

1. **순서 준수**: Phase 0부터 순서대로 실행, 절대 건너뛰지 않음
2. **요구사항 먼저**: 충분도 판단 없이 바로 계획 X
3. **devil 2회**: 현실성 검증(요구사항 후) + 계획 검증(완성 후)
4. **유형 분류**: 코드베이스 탐색 필요 여부 먼저 결정
5. **Brain 먼저**: 패턴 확인 없이 바로 계획 X (있는 경우)
6. **예시 기반**: 규칙이 아닌 예시 코드 참고
7. **Progressive Disclosure**: 필요한 패턴만 로드
8. **Plan Mode 필수**: EnterPlanMode로 사용자 승인
9. **시각화 권유**: 복잡한 구조는 ASCII 다이어그램 제안
10. **에이전트 배너**: devil/angel 호출 시 시작/완료 배너 출력

---

**Last Updated**: 2026-02-06
